(()=>{const mic=document.getElementById("mic");const input=document.getElementById("chat-input");const send=document.getElementById("chat-send");if(!mic||!input)return;const ghost=document.getElementById("ghost")||(()=>{const g=document.createElement("div");g.id="ghost";g.className="ghost";document.querySelector(".input-wrap")?.appendChild(g);return g})();const SR=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SR){mic.style.display="none";return}const rec=new SR();rec.lang="en-GB";rec.interimResults=true;rec.continuous=true;let finalText="";const start=()=>{finalText=input.value||"";ghost.textContent="";mic.setAttribute("aria-pressed","true");try{rec.start()}catch(_){}};const stop=()=>{try{rec.stop()}catch(_){ }mic.setAttribute("aria-pressed","false");ghost.textContent=""};mic.addEventListener("click",()=>{const on=mic.getAttribute("aria-pressed")==="true";on?stop():start()});send?.addEventListener("click",stop);rec.onresult=e=>{let interim="";for(let i=e.resultIndex;i<e.results.length;i++){const t=e.results[i][0].transcript;if(e.results[i].isFinal)finalText+=(finalText?" ":"")+t.trim();else interim+=t}const live=finalText+(interim?(finalText?" ":"")+interim:"");ghost.textContent=live;input.value=live;input.selectionStart=input.selectionEnd=input.value.length};rec.onerror=stop;rec.onend=stop})();
